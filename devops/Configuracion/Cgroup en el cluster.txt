https://www.techrepublic.com/article/how-to-quickly-install-kubernetes-on-ubuntu/

http://vijayshinva.github.io/kubernetes/2018/07/28/setting-up-a-kubernetes-cluster-on-a-windows-laptop-using-hyper-v.html


https://stackoverflow.com/questions/52119985/kubeadm-init-shows-kubelet-isnt-running-or-healthy


systemd


I had this same issue when trying to initialize my k8s cluster. In my case, the error was rooting from Docker and Kubelet having inconsistent cgroups.

To solve it, first find Docker cgroup:

docker info | grep Cgroup

The result of the above command would be something like this:

Cgroup Driver: cgroupfs
Cgroup Version: 1
Then, update kubelet args (KUBELET_KUBECONFIG_ARGS) in /etc/systemd/system/kubelet.service.d/10-kubeadm.conf and add a --cgroup-driver flag corresponsing to docker cgroup (in this case cgroupfs).

My config file looks like this after the modification:

...
Environment="KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/e`tc/kubernetes/kubelet.conf --cgroup-driver=cgroupfs"
...
Finally, run kubeadm reset and then kubeadm init.




# First diasbale swap
sudo swapoff -a

# And then to disable swap on startup in /etc/fstab
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab



/etc/kubernetes/manifests


net use e: \\CA214150\repos


https://github.com/justmeandopensource/kubernetes/blob/master/docs/install-cluster-ubuntu-20.md


Solucion a dns pending
https://www.weave.works/docs/net/latest/kubernetes/kube-addon/
kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"


-- obtener el string de coneccion al cluster
kubeadm token create --print-join-command

sudo kubeadm join 172.16.202.61:6443 --token z5ku06.zt3jwjfzoqgdq69i --discovery-token-ca-cert-hash sha256:c5d4617cd75e46f2dfe7727babc87342a5e29235f6d90c65cd4952ae2a6c5cc7


kubectl create -f https://projectcalico.docs.tigera.io/manifests/tigera-operator.yaml

kubectl create -f https://projectcalico.docs.tigera.io/manifests/custom-resources.yaml

kubectl taint nodes --all node-role.kubernetes.io/master-



---- darle todo el espacio libre a una particion en linux ubuntu
sudo lvextend -rl +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv




kubeadm v1.25.3 error cri container runtime is not running
https://bitsanddragons.wordpress.com/2022/10/20/error-cri-container-runtime-is-not-running-while-kubeadm-init-on-centos-7-x/
## > rm /etc/containerd/config.toml
## > systemctl restart containerd
## > kubeadm init

or 

## > sudo nano /etc/containerd/config.toml
comment disabled_plugins = ["cri"]
## > systemctl restart containerd


version = 2

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/usr/lib/cni"
      conf_dir = "/etc/cni/net.d"
  [plugins."io.containerd.internal.v1.opt"]
    path = "/var/lib/containerd/opt"



lsof -i
lsof -i -P -n



https://juliorestrepo.wordpress.com/2020/10/05/systemd-resolved-remove-uninstall-disable-ubuntu/
systemctl disable systemd-resolved
systemctl stop systemd-resolved
nano /etc/resolv.conf
nameserver 1.1.1.1
nameserver 8.8.8.8


********************************** add node
sudo kubeadm token generate
kubeadm token create jmbnyx.iosdwdfzdit3jq7r --print-join-command


cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# immediately turn off swap - until reboot
sudo swapoff -a
# turn off swap after restart
sudo sed -i 's|^/swap.img|#/swap.img|g' /etc/fstab

# reboot sysctl
sudo sysctl --system


/etc/containerd/config.toml


sudo mkdir /run/systemd/resolve/
sudo ln -s /etc/resolv.conf /run/systemd/resolve/resolv.conf



